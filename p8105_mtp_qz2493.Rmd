---
title: "p8105_mtp_qz2493.Rmd"
author: "Qingyue Zhuo qz2493"
date: "2022-10-22"
output: github_document
---
#### initial set-up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
library(patchwork)
library(gridExtra)
library(viridis)

options(tibble.print_min = 3)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%")

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

### Problem 1
The raw data records the weight of three dogs - Raisin, Simone, Gagne from 2018 to 2022, together with the weight of a standard object and occasional notes. The goal of this report includes tidying and restructuring the data set into a more readable manner; describing the statistical features of the data set; and visualizing the distribution and trend of dogs' weight.

#### import and tidy the data
After loading the raw data, I converted the format of "date" variable from "day-counts" to "year-month-date" with as.POSIXlt() function. 
```{r}
total_df = 
  read_excel("dogweights_07may2022.xlsx", skip = 1) %>%
  janitor::clean_names() %>%
  
  # reorganize the "date" variable
  mutate(
    date = as.POSIXlt.numeric(as.numeric(date)*24*60*60, tz = "UTC", origin = "1899-12-30"),
    date = as.character(date),
    date = substr(date, 1, 10)
    ) 
```

The first dataframe contains the weight of dogs on specific dates. I unified the unit of weight to "lbs" to increase consistency. I then manually corrected two measurement/recording errors in the table after comparing with other observations: Raisin's weight should be 17.9375 rather than 7.375 pounds on 14-Aug-2019; and the weight of standard object should be 21.027 instead of 29.625 pounds on 25-Apr-2022.
```{r}
weight_df =
  select(total_df, date:std) %>%
  
  # separate the weight measurements by unit
  separate(raisin, into = c("raisin_lbs", "raisin_oz")) %>%
  separate(simone, into = c("simone_lbs", "simone_oz")) %>%
  separate(gagne, into = c("gagne_lbs", "gagne_oz")) %>%
  separate(std, into = c("std_lbs", "std_oz")) %>%
  
  # unify the unit to "lbs"
  mutate(
    raisin = as.numeric(raisin_lbs) + (1/16) * as.numeric(raisin_oz),
    simone = as.numeric(simone_lbs) + (1/16) * as.numeric(simone_oz),
    gagne = as.numeric(gagne_lbs) + (1/16) * as.numeric(gagne_oz),
    std = as.numeric(std_lbs) + (1/16) * as.numeric(std_oz)) %>%
  select(date, raisin:std) %>%
  
  # correct the measurement/ recording errors
  mutate(
    raisin = ifelse(raisin < 10, raisin + 10, raisin),
    std = ifelse(std == 29.6250, 20 + 15.4/15, std)
  )

weight_df 
```

The second dataset contains notes and the date on which they were written. So I dropped the dates without notes.
```{r}
note_df = 
  select(total_df, date, x6) %>%
  rename("note" = "x6") %>%
  # drop the dates without written notes
  drop_na()
note_df
```

#### save the tidy datasets
```{r}
write_csv(weight_df, "weight_data.csv")
write_csv(note_df,"note.csv")
```

### Problem 2
#### load csv. data
```{r}
weight_data = read_csv("weight_data.csv")
note_data = read_csv("note.csv")
```
The resulting weight dataset contains  `r nrow(weight_data)` observations of `r ncol(weight_data)` variables including `r names(weight_data)`. There are 360 unique dates that are non-NA.
#### obtain the number of unique date
```{r}
# number of distinct date
weight_data %>% 
  select(date) %>%
  distinct 
  
# number of date that is non-NA
sum(!is.na(weight_data$date))
```
#### generate table of observation counts, mean, and standard deviation
I applied pivot_longer to incorperated three dogs and the standard object into a new variable named "dog". Their weights are stored in another new variable called "weight".I grouped the dogs by name and obtained the number of observations as well as mean and standard deviations of each dog.
```{r}
weight_data %>%
  
  # create new variables of "dog name" and "dog weights"
  pivot_longer(
    raisin:std,
    names_to = "dog",
    values_to = "weight"
  ) %>%
  
  # group dogs by name
  arrange(dog) %>%
  group_by(dog) %>%
  summarize(
    total_observations = sum(!is.na(weight)),
    mean = round(mean(weight,na.rm = TRUE),3),
    standard_deviation = round(sd(weight, na.rm = TRUE),3)
) %>%
  
  # generate a well-formatted table
  knitr::kable()
```


### Problem 3
```{r}
weight_data_pivot = 
  weight_data %>%
  pivot_longer(
    raisin:std,
    names_to = "dog",
    values_to = "weight")
```
#### create boxplot of weights distribution
I generated a boxplot to display the distribution of weights for each dog. We can conclude from the plot that Raisin weighs most, with an average weight around 18 lbs, while Gagne and Simone weight less and similarly, with average weights around 10 lbs. Besides, Simon's weight has greatest variance because its boxplot spread out most. Gagne's weight has smallest variance, it might because Gagne has minimal data recorded.

```{r}
plot1 =
  ggplot(weight_data_pivot, aes(x = dog, y = weight, fill = dog)) +
  geom_boxplot() +
  scale_fill_viridis(discrete = TRUE, alpha = 0.6) +
  labs(
    title = "Distribution of Dog Weights",
    y = "weight (lbs)")
```
#### generate scatter plot of weight over time
I then created a scatter plot to show each dog's weight over time. We can conclude that dog's weight has a decreasing trend since 2018 as they get older. Gagne's weight dropped rapidly during the last six month of life. For Raisin and Simone, their weight almost follow the same the fluctuation pattern: they both underwent a weight decrease period after their company- Gagne died; 
```{r}
plot2 = 
  ggplot(weight_data_pivot, aes(x = date, y = weight, color = dog)) + 
  geom_smooth(se = FALSE, alpha = .5) +
  geom_point(aes(color = dog), alpha = .5) +
  labs(
    title = "Weight over Time",
    x = "date",
    y = "weight (lbs)")
  
combined_plot = grid.arrange(plot1, plot2, nrow = 1)
ggsave("dog_weight_plot.pdf", combined_plot, width = 8, height = 5)
```

